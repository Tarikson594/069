<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Frankfurt Jump & Run â€“ Iteration 6.1 (Level-HintergrÃ¼nde)</title>
  <style>
    body,html{margin:0;padding:0;height:100%;background:#0b0d14;color:#fff;font-family:sans-serif}
    canvas{display:block;width:100%;height:100%;}
    #hud{position:absolute;left:12px;top:12px;z-index:5;display:flex;gap:10px;align-items:center;background:rgba(10,15,30,.6);border:1px solid #263355;border-radius:10px;padding:6px 10px}
    #hud .badge{background:rgba(20,30,55,.7);border:1px solid #30426f;padding:4px 8px;border-radius:8px;font-weight:700}
    #dialog{position:absolute;left:50%;top:18%;transform:translateX(-50%);z-index:10;background:#0f152a;border:1px solid #2b3f72;border-radius:12px;display:none;max-width:min(760px,92vw)}
    #dialog header{padding:10px 14px;border-bottom:1px solid #22335c;font-weight:800}
    #dialog .content{padding:12px 14px;line-height:1.45}
    #dialog .choices{padding:0 14px 14px;display:flex;flex-direction:column;gap:8px}
    #dialog button{background:#182246;color:#e9ecff;border:1px solid #2d3b70;padding:10px 12px;border-radius:10px;cursor:pointer;text-align:left}
    #dialog button:hover{background:#1f2b57}
    .overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(6,10,20,.72);z-index:20;text-align:center;padding:20px}
    .panel{background:#0f1426;border:1px solid #2c365e;border-radius:14px;padding:18px;text-align:center;max-width:min(680px,92%)}
    .panel h1{margin:.2em 0;font-size:28px}
    .panel p{opacity:.95}
    .btn{background:#182246;color:#e9ecff;border:1px solid #2d3b70;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700;margin-top:10px}
    #highscores{text-align:left;margin-top:10px;padding:0;list-style:none}
    #highscores li{padding:4px 0;border-bottom:1px solid #2c365e;font-size:14px}
  </style>
</head>
<body>
  <canvas id="game" width="960" height="540"></canvas>
  <div id="hud">
    <span class="badge" id="money">â‚¬100</span>
    <span class="badge" id="karma">Karma:0</span>
    <span class="badge" id="level">Level: 1</span>
  </div>
  <div id="dialog">
    <header>Entscheidung</header>
    <div class="content" id="dlgText"></div>
    <div class="choices" id="dlgChoices"></div>
  </div>
  <div id="endOL" class="overlay">
    <div class="panel">
      <h1 id="endTitle">Level geschafft ðŸŽ‰</h1>
      <p id="endSummary">Zusammenfassung</p>
      <ul id="highscores"></ul>
      <button class="btn" id="btnNext">NÃ¤chstes Level</button>
      <button class="btn" id="btnRestart">Neu starten</button>
    </div>
  </div>
<script>
(() => {
  const canvas=document.getElementById('game');
  const ctx=canvas.getContext('2d');
  const hudMoney=document.getElementById('money');
  const hudKarma=document.getElementById('karma');
  const hudLevel=document.getElementById('level');
  const dialog=document.getElementById('dialog');
  const dlgText=document.getElementById('dlgText');
  const dlgChoices=document.getElementById('dlgChoices');
  const endOL=document.getElementById('endOL');
  const endTitle=document.getElementById('endTitle');
  const endSummary=document.getElementById('endSummary');
  const highscores=document.getElementById('highscores');
  const btnNext=document.getElementById('btnNext');
  const btnRestart=document.getElementById('btnRestart');

  btnRestart.onclick=()=>location.reload();

  const player={x:60,y:0,w:30,h:40,vx:0,vy:0,onGround:false,money:100,karma:0};
  let cameraX=0;
  let gameEnded=false;
  let startTime=Date.now();
  let currentLevel=0;

  const levels=[
    {name:'Bahnhofsviertel',bg:'#1b0c2f',plats:[{x:0,y:460,w:1200,h:120},{x:1300,y:460,w:900,h:120}],
     triggers:[
       {id:'beggar',x:300,text:'â€ž4 â‚¬ nach GieÃŸenâ€¦ ehrlich!â€œ',choices:[{label:'4 â‚¬ geben',fn:()=>{money(-4);karma(+1);}},{label:'Ablehnen',fn:()=>karma(-1)}]},
       {id:'dealer',x:700,text:'Dealer: â€žWillst du was kaufen? (20 â‚¬)â€œ',choices:[{label:'Kaufen',fn:()=>{money(-20);karma(-2);}},{label:'Nein danke',fn:()=>{}}]},
       {id:'taxi',x:1100,text:'Taxifahrer: â€žKurzfahrt fÃ¼r 20 â‚¬?â€œ',choices:[{label:'Einsteigen',fn:()=>money(-20)},{label:'Weiterlaufen',fn:()=>{}}]},
       {id:'club',x:1500,text:'Club-Promoter: â€žTechno-Event, Eintritt 15 â‚¬â€œ',choices:[{label:'Rein da',fn:()=>money(-15)},{label:'Ablehnen',fn:()=>{}}]}
     ]},
    {name:'Zeil',bg:'#cce7ff',plats:[{x:0,y:460,w:1200,h:120},{x:1300,y:460,w:900,h:120}],
     triggers:[
       {id:'shopping',x:350,text:'Kollege: â€žShopping, nur ein Shirt fÃ¼r 50 â‚¬?â€œ',choices:[{label:'Kaufen',fn:()=>money(-50)},{label:'Nein',fn:()=>{}}]},
       {id:'flyer',x:700,text:'Flyer-Verteiler: â€žBitte unterschreiben!â€œ',choices:[{label:'Unterschreiben',fn:()=>karma(+1)},{label:'Ignorieren',fn:()=>karma(-1)}]},
       {id:'musician',x:1100,text:'StraÃŸenmusiker: â€žSpende 2 â‚¬?â€œ',choices:[{label:'Spenden',fn:()=>money(-2)},{label:'Vorbeigehen',fn:()=>{}}]},
       {id:'handy',x:1500,text:'Handyshop: â€žNeues Handy fÃ¼r 400 â‚¬?â€œ',choices:[{label:'Kaufen (Game Over)',fn:()=>{money(-400);endGame(true);}},{label:'Nein',fn:()=>{}}]}
     ]},
    {name:'Bornheim',bg:'#d9f0c7',plats:[{x:0,y:460,w:1200,h:120},{x:1300,y:460,w:900,h:120}],
     triggers:[
       {id:'aepler',x:350,text:'Nachbar: â€žKomm auf einen Ã„ppler (5 â‚¬)â€œ',choices:[{label:'Ja',fn:()=>money(-5)},{label:'Nein',fn:()=>{}}]},
       {id:'flohmarkt',x:700,text:'Flohmarkt: â€žSchallplatte fÃ¼r 10 â‚¬?â€œ',choices:[{label:'Kaufen',fn:()=>money(-10)},{label:'Weitergehen',fn:()=>{}}]},
       {id:'hund',x:1100,text:'Hundebesitzer: â€žKannst du auf Bello aufpassen?â€œ',choices:[{label:'Ja',fn:()=>karma(+1)},{label:'Nein',fn:()=>karma(-1)}]},
       {id:'kneipe',x:1500,text:'Kneipenwirt: â€žHappy Hour! (8 â‚¬)â€œ',choices:[{label:'Mitmachen',fn:()=>money(-8)},{label:'Weiter',fn:()=>{}}]}
     ]},
    {name:'Mainufer',bg:'#99d9f2',plats:[{x:0,y:460,w:1200,h:120},{x:1300,y:460,w:900,h:120}],
     triggers:[
       {id:'jogger',x:350,text:'Jogger: â€žSpende fÃ¼r den Laufverein?â€œ',choices:[{label:'Spenden 5 â‚¬',fn:()=>{money(-5);karma(+1)}},{label:'Nein',fn:()=>{}}]},
       {id:'biergarten',x:700,text:'Biergarten: â€žRadler 8 â‚¬?â€œ',choices:[{label:'Ja',fn:()=>money(-8)},{label:'Nein',fn:()=>{}}]},
       {id:'strassenfest',x:1100,text:'StraÃŸenfest: â€žEintritt 10 â‚¬â€œ',choices:[{label:'Mitmachen',fn:()=>{money(-10);karma(+1)}},{label:'Nein',fn:()=>{}}]},
       {id:'tourist',x:1500,text:'Touristen: â€žKannst du ein Foto machen?â€œ',choices:[{label:'Ja',fn:()=>karma(+1)},{label:'Ignorieren',fn:()=>karma(-1)}]}
     ]}
  ];

  function loadLevel(i){
    currentLevel=i;gameEnded=false;cameraX=0;
    player.x=60;player.y=world.groundY-56;player.vx=0;player.vy=0;
    fired.clear();
    hudLevel.textContent='Level: '+(i+1)+'/'+levels.length+' â€“ '+levels[i].name;
  }

  const world={width:2200,height:canvas.height,groundY:460};
  const fired=new Set();
  let dialogOpen=false;

  function openDialog(tr){dialogOpen=true;dialog.style.display='block';dlgText.textContent=tr.text;dlgChoices.innerHTML='';tr.choices.forEach(ch=>{const b=document.createElement('button');b.textContent=ch.label;b.onclick=()=>{ch.fn();fired.add(tr.id);closeDialog();};dlgChoices.appendChild(b);});}
  function closeDialog(){dialog.style.display='none';dialogOpen=false;}

  const GRAVITY=1800,MOVE=260,JUMP=-620;const keys=new Set();
  addEventListener('keydown',e=>{keys.add(e.key.toLowerCase());});
  addEventListener('keyup',e=>keys.delete(e.key.toLowerCase()));

  function aabb(a,b){return a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;}
  function money(d){player.money=Math.max(0,player.money+d);hudMoney.textContent='â‚¬'+player.money;}
  function karma(d){player.karma+=d;hudKarma.textContent='Karma:'+player.karma;}

  function endGame(force){
    if(force){endTitle.textContent='Game Over';btnNext.style.display='none';endOL.style.display='flex';}
  }

  function update(dt,t){
    if(gameEnded)return;
    let move=0;if(keys.has('a')||keys.has('arrowleft'))move-=1;if(keys.has('d')||keys.has('arrowright'))move+=1;player.vx=move*MOVE;
    const jump=keys.has(' ')||keys.has('w')||keys.has('arrowup');if(jump&&player.onGround){player.vy=JUMP;player.onGround=false;}
    player.vy+=GRAVITY*dt;player.x+=player.vx*dt;player.y+=player.vy*dt;

    player.onGround=false;for(const p of levels[currentLevel].plats){if(aabb(player,p)){const prevY=player.y-player.vy*dt;if(prevY+player.h<=p.y+4){player.y=p.y-player.h;player.vy=0;player.onGround=true;}else{if(player.x+player.w/2<p.x+p.w/2)player.x=p.x-player.w;else player.x=p.x+p.w;player.vx=0;}}}

    player.x=Math.max(0,Math.min(world.width-player.w,player.x));
    const lead=120*Math.sign(player.vx);const targetCam=Math.max(0,Math.min(world.width-canvas.width,player.x-canvas.width/2+lead));cameraX+=(targetCam-cameraX)*0.12;

    if(!dialogOpen){for(const tr of levels[currentLevel].triggers){if(fired.has(tr.id))continue;const bx=tr.x,by=world.groundY-40;if(aabb(player,{x:bx,y:by,w:40,h:40})){openDialog(tr);break;}}}
    if(player.x>world.width-80&&!gameEnded){
      gameEnded=true;
      const timeTaken=Math.round((Date.now()-startTime)/1000);
      const score=player.money+(player.karma*10)-timeTaken;
      endSummary.textContent=`Geld: â‚¬${player.money} Â· Karma ${player.karma} Â· Zeit ${timeTaken}s Â· Score ${score}`;
      let scores=JSON.parse(localStorage.getItem('scores')||'[]');
      scores.push({money:player.money,karma:player.karma,time:timeTaken,score:score,level:levels[currentLevel].name});
      if(scores.length>10) scores=scores.slice(-10);
      scores.sort((a,b)=>b.score-a.score);
      localStorage.setItem('scores',JSON.stringify(scores));
      highscores.innerHTML=scores.map(s=>`<li>${s.level}: â‚¬${s.money} Â· Karma ${s.karma} Â· ${s.time}s Â· Score ${s.score}</li>`).join('');
      if(currentLevel<levels.length-1){endTitle.textContent='Level geschafft ðŸŽ‰';btnNext.style.display='inline-block';btnNext.onclick=()=>{endOL.style.display='none';loadLevel(currentLevel+1);};}else{endTitle.textContent='Alle Levels geschafft ðŸŽ‰';btnNext.style.display='none';}
      endOL.style.display='flex';
    }
  }

  function drawPlatforms(){for(const p of levels[currentLevel].plats){ctx.fillStyle='#e6e2d3';ctx.fillRect(p.x-cameraX,p.y,p.w,p.h);ctx.fillStyle='#c9c3b1';ctx.fillRect(p.x-cameraX,p.y-4,p.w,4);}}
  function drawPlayer(){ctx.fillStyle='red';ctx.fillRect(player.x-cameraX,player.y,player.w,player.h);}
  function drawEventBlocks(t){for(const tr of levels[currentLevel].triggers){if(fired.has(tr.id))continue;const bx=tr.x-cameraX,by=world.groundY-40;const bob=Math.sin(t/420+tr.x)*4;ctx.fillStyle='#ffd24d';ctx.strokeStyle='#a07a1b';ctx.lineWidth=3;ctx.fillRect(bx,by+bob,40,40);ctx.strokeRect(bx,by+bob,40,40);ctx.fillStyle='#1b1b1b';ctx.font='bold 24px sans-serif';ctx.fillText('?',bx+12,by+28+bob);}}

  function render(ts){ctx.clearRect(0,0,canvas.width,canvas.height);ctx.fillStyle=levels[currentLevel].bg;ctx.fillRect(0,0,canvas.width,canvas.height);drawPlatforms();drawEventBlocks(ts||0);drawPlayer();}

  let last=0;function loop(ts){const dt=Math.min(0.033,(ts-last)/1000||0.016);last=ts;update(dt,ts);render(ts);requestAnimationFrame(loop);}requestAnimationFrame(loop);

  loadLevel(0);
})();
</script>
</body>
</html>
